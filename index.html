<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Python Adventures ‚Äî Learn Python Through Stories</title>
    <meta name="description" content="Learn Python through magical stories! An interactive course for kids with 10 enchanting chapters.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ú®</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg: #050508;
            --bg-sidebar: #0a0a10;
            --bg-card: rgba(255,255,255,0.03);
            --bg-card-hover: rgba(255,255,255,0.06);
            --accent: #fbbf24;
            --accent-dim: rgba(251,191,36,0.15);
            --secondary: #8b5cf6;
            --secondary-dim: rgba(139,92,246,0.15);
            --success: #10b981;
            --danger: #ef4444;
            --text: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #475569;
            --border: rgba(255,255,255,0.06);
            --border-accent: rgba(251,191,36,0.3);
            --sidebar-w: 300px;
            --font-ui: 'Inter', sans-serif;
            --font-heading: 'Fredoka', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }
        html { font-size: 125%; scroll-behavior: smooth; }
        body {
            font-family: var(--font-ui);
            background: var(--bg);
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

        /* ===== LAYOUT ===== */
        .app { display: flex; min-height: 100vh; }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: var(--sidebar-w);
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            position: fixed;
            top: 0; left: 0; bottom: 0;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .sidebar-header {
            padding: 1.2rem 1rem;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0;
            background: var(--bg-sidebar);
            z-index: 2;
        }
        .sidebar-title {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            color: var(--accent);
            display: flex; align-items: center; gap: 0.5rem;
        }
        .sidebar-progress {
            margin-top: 0.6rem;
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.06);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #f59e0b);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        .progress-text {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 0.3rem;
        }
        .sidebar-chapters {
            flex: 1;
            padding: 0.5rem 0;
            overflow-y: auto;
        }
        .chapter-group { border-bottom: 1px solid var(--border); }
        .chapter-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.7rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .chapter-header:hover { background: var(--bg-card-hover); }
        .chapter-header.active { color: var(--accent); }
        .chapter-chevron {
            margin-left: auto;
            transition: transform 0.2s;
            font-size: 0.6rem;
            opacity: 0.5;
        }
        .chapter-chevron.expanded { transform: rotate(90deg); }
        .chapter-check {
            width: 18px; height: 18px;
            border-radius: 50%;
            border: 2px solid var(--text-muted);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.55rem;
            flex-shrink: 0;
            transition: all 0.3s;
        }
        .chapter-check.done {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        .chapter-lessons {
            display: none;
            padding-bottom: 0.3rem;
        }
        .chapter-lessons.expanded { display: block; }
        .lesson-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            cursor: pointer;
            font-size: 0.7rem;
            color: var(--text-muted);
            transition: all 0.2s;
            border-left: 2px solid transparent;
        }
        .lesson-item:hover { background: var(--bg-card-hover); color: var(--text-secondary); }
        .lesson-item.active {
            color: var(--accent);
            background: var(--accent-dim);
            border-left-color: var(--accent);
        }
        .lesson-dot {
            width: 6px; height: 6px;
            border-radius: 50%;
            background: var(--text-muted);
            flex-shrink: 0;
        }
        .lesson-item.active .lesson-dot { background: var(--accent); }

        /* ===== MAIN CONTENT ===== */
        .main {
            flex: 1;
            margin-left: var(--sidebar-w);
            min-height: 100vh;
        }
        .content-wrapper {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 2rem 4rem;
        }

        /* ===== MOBILE ===== */
        .hamburger {
            display: none;
            position: fixed;
            top: 0.8rem; left: 0.8rem;
            z-index: 200;
            width: 40px; height: 40px;
            background: rgba(10,10,16,0.9);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            color: var(--text);
            font-size: 1.2rem;
            backdrop-filter: blur(10px);
        }
        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 90;
        }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main { margin-left: 0; }
            .hamburger { display: flex; }
            .overlay.show { display: block; }
            .content-wrapper { padding: 3.5rem 1rem 3rem; }
        }

        /* ===== LESSON CONTENT ===== */
        .lesson-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        .lesson-chapter-label {
            font-size: 0.65rem;
            color: var(--secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }
        .lesson-title {
            font-family: var(--font-heading);
            font-size: 1.6rem;
            color: var(--accent);
            margin-bottom: 0.4rem;
        }
        .lesson-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Story Card */
        .story-card {
            background: linear-gradient(135deg, rgba(139,92,246,0.08), rgba(251,191,36,0.05));
            border: 1px solid rgba(139,92,246,0.15);
            border-radius: 12px;
            padding: 1.2rem 1.4rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .story-card::before {
            content: 'üìñ';
            position: absolute;
            top: -8px; right: -8px;
            font-size: 3rem;
            opacity: 0.08;
        }
        .story-card-label {
            font-family: var(--font-heading);
            font-size: 0.7rem;
            color: var(--secondary);
            margin-bottom: 0.5rem;
            display: flex; align-items: center; gap: 0.4rem;
        }
        .story-card p {
            font-size: 0.82rem;
            line-height: 1.8;
            color: var(--text-secondary);
            font-style: italic;
        }
        .story-card strong { color: var(--text); font-style: normal; }

        /* Glass Card */
        .glass-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.2rem 1.4rem;
            margin-bottom: 1.5rem;
        }
        .glass-card h3 {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 0.8rem;
            display: flex; align-items: center; gap: 0.4rem;
        }
        .glass-card p, .glass-card li {
            font-size: 0.82rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }
        .glass-card strong { color: var(--text); }
        .glass-card ul { padding-left: 1.2rem; margin: 0.5rem 0; }
        .glass-card li { margin-bottom: 0.3rem; }

        /* Code Blocks */
        .code-block {
            background: #0d1117;
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 10px;
            margin: 1rem 0 1.5rem;
            overflow: hidden;
            position: relative;
        }
        .code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.06);
            font-size: 0.6rem;
            color: var(--text-muted);
        }
        .copy-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.55rem;
            font-family: var(--font-ui);
            transition: all 0.2s;
        }
        .copy-btn:hover { border-color: var(--accent); color: var(--accent); }
        .copy-btn.copied { border-color: var(--success); color: var(--success); }
        .code-content {
            padding: 1rem;
            overflow-x: auto;
            font-family: var(--font-code);
            font-size: 0.72rem;
            line-height: 1.7;
        }
        .kw { color: #c084fc; font-weight: 600; }
        .str { color: #86efac; }
        .fn { color: #93c5fd; }
        .num { color: #fbbf24; }
        .cmt { color: rgba(255,255,255,0.3); font-style: italic; }
        .op { color: #f472b6; }
        .bi { color: #67e8f9; }

        /* Interactive Section */
        .interactive-card {
            background: linear-gradient(135deg, rgba(251,191,36,0.05), rgba(251,191,36,0.02));
            border: 1px solid rgba(251,191,36,0.15);
            border-radius: 12px;
            padding: 1.2rem 1.4rem;
            margin-bottom: 1.5rem;
        }
        .interactive-card h3 {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 0.3rem;
        }
        .interactive-card .subtitle {
            font-size: 0.72rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        /* Quiz Section */
        .quiz-card {
            background: linear-gradient(135deg, rgba(16,185,129,0.06), rgba(16,185,129,0.02));
            border: 1px solid rgba(16,185,129,0.15);
            border-radius: 12px;
            padding: 1.2rem 1.4rem;
            margin-bottom: 1.5rem;
        }
        .quiz-card h3 {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--success);
            margin-bottom: 0.8rem;
        }
        .quiz-option {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.6rem 1rem;
            margin-bottom: 0.5rem;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: var(--font-ui);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quiz-option:hover { border-color: var(--success); background: rgba(16,185,129,0.05); }
        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(16,185,129,0.15);
            color: var(--success);
        }
        .quiz-option.wrong {
            border-color: var(--danger);
            background: rgba(239,68,68,0.1);
            color: var(--danger);
        }
        .quiz-result {
            margin-top: 0.6rem;
            font-size: 0.75rem;
            min-height: 1.5rem;
        }

        /* Complete Button */
        .complete-section {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }
        .complete-btn {
            font-family: var(--font-heading);
            font-size: 0.85rem;
            padding: 0.7rem 2rem;
            background: linear-gradient(135deg, var(--accent), #f59e0b);
            color: var(--bg);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .complete-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(251,191,36,0.3); }
        .complete-btn.completed {
            background: var(--success);
            cursor: default;
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            padding: 1.5rem 0;
            margin-top: 1rem;
            border-top: 1px solid var(--border);
        }
        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: var(--font-ui);
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-btn:hover { border-color: var(--accent); color: var(--accent); }
        .nav-btn:disabled { opacity: 0.3; cursor: default; }
        .nav-btn:disabled:hover { border-color: var(--border); color: var(--text-secondary); }

        /* Shared interactive styles */
        .i-btn {
            font-family: var(--font-heading);
            font-size: 0.75rem;
            padding: 0.5rem 1.2rem;
            border: 1px solid var(--border-accent);
            background: var(--accent-dim);
            color: var(--accent);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .i-btn:hover { background: rgba(251,191,36,0.25); transform: translateY(-1px); }
        .i-flex { display: flex; gap: 0.6rem; flex-wrap: wrap; justify-content: center; margin: 0.8rem 0; }
        .i-item {
            width: 80px; height: 85px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border: 1px solid var(--border);
            background: var(--bg-card);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.6rem;
        }
        .i-item:hover { border-color: var(--accent); transform: translateY(-3px); }
        .i-item.selected { border-color: var(--accent); background: var(--accent-dim); box-shadow: 0 0 15px rgba(251,191,36,0.15); }
        .i-item.revealed { border-color: var(--success); background: rgba(16,185,129,0.1); }
        .i-label { font-family: var(--font-code); font-size: 0.55rem; color: var(--text-muted); margin-top: 0.2rem; }
        .i-value { font-family: var(--font-code); font-size: 0.6rem; color: var(--accent); opacity: 0; transition: opacity 0.3s; }
        .i-item.revealed .i-value { opacity: 1; }
        .i-result { text-align: center; font-size: 0.75rem; color: var(--accent); margin-top: 0.6rem; min-height: 1.5rem; }
        .i-slots {
            display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;
            min-height: 70px; padding: 0.8rem;
            border: 2px dashed var(--border);
            border-radius: 10px; margin: 0.8rem 0;
            align-items: center;
        }
        .i-slot {
            width: 55px; height: 60px;
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: var(--bg-card);
        }
        .i-slot .idx { font-family: var(--font-code); font-size: 0.5rem; color: var(--text-muted); }
        .i-slot .emoji { font-size: 1.3rem; }
        .i-info { font-family: var(--font-code); font-size: 0.65rem; color: var(--text-muted); text-align: center; margin-top: 0.4rem; }

        /* Spell scroll input */
        .spell-input {
            width: 100%;
            padding: 0.5rem 0.8rem;
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: var(--font-code);
            font-size: 0.72rem;
            margin-bottom: 0.6rem;
        }
        .spell-input:focus { outline: none; border-color: var(--secondary); }
        .spell-result {
            padding: 0.6rem;
            background: #0d1117;
            border-radius: 8px;
            font-family: var(--font-code);
            font-size: 0.7rem;
            color: var(--accent);
            margin-top: 0.5rem;
            min-height: 2rem;
        }

        /* Crystal ball */
        .crystal-input {
            width: 100%;
            padding: 0.5rem 0.8rem;
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: var(--font-code);
            font-size: 0.72rem;
            margin-bottom: 0.5rem;
        }
        .crystal-input:focus { outline: none; border-color: var(--accent); }
        .crystal-prompt { font-family: var(--font-code); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 0.3rem; }
        .crystal-output {
            background: #0d1117;
            border-radius: 8px;
            padding: 0.8rem;
            font-family: var(--font-code);
            font-size: 0.65rem;
            line-height: 1.8;
            color: var(--text-secondary);
            min-height: 3rem;
            margin-top: 0.5rem;
        }

        /* Pet factory */
        .factory-group { margin-bottom: 0.8rem; }
        .factory-label { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 0.4rem; }
        .factory-opts { display: flex; gap: 0.4rem; flex-wrap: wrap; }
        .factory-opt {
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--border);
            background: var(--bg-card);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.65rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-ui);
        }
        .factory-opt:hover { border-color: var(--accent); }
        .factory-opt.selected { border-color: var(--accent); background: var(--accent-dim); color: var(--accent); }
        .conveyor {
            display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center;
            min-height: 60px; padding: 0.6rem;
            border: 1px dashed var(--border);
            border-radius: 8px; margin: 0.6rem 0;
        }
        .pet-card {
            padding: 0.5rem 0.8rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.65rem;
        }
        .pet-card:hover { border-color: var(--accent); }
        .pet-card .pet-icon { font-size: 1.2rem; display: block; }
        .pet-card .pet-name { color: var(--text); font-weight: 600; }
        .pet-card .pet-sound { color: var(--text-muted); font-size: 0.55rem; }

        /* Safety net */
        .trick-btns { display: flex; gap: 0.4rem; flex-wrap: wrap; justify-content: center; margin-bottom: 0.8rem; }
        .trick-btn {
            padding: 0.4rem 0.8rem;
            border: 1px solid rgba(225,29,72,0.3);
            background: rgba(225,29,72,0.05);
            border-radius: 6px;
            color: var(--text-secondary);
            font-family: var(--font-code);
            font-size: 0.65rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .trick-btn:hover { border-color: #e11d48; background: rgba(225,29,72,0.1); }
        .safety-display {
            text-align: center;
            min-height: 100px;
            padding: 0.8rem;
            background: #0d1117;
            border-radius: 8px;
        }
        .safety-display .acrobat { font-size: 2rem; transition: all 0.3s; display: block; margin-bottom: 0.5rem; }
        .safety-msg {
            font-family: var(--font-code);
            font-size: 0.6rem;
            margin-bottom: 0.3rem;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
        }
        .safety-msg.try-msg { color: var(--text-secondary); }
        .safety-msg.catch-msg { color: var(--danger); background: rgba(239,68,68,0.1); }
        .safety-msg.safe-msg { color: var(--success); background: rgba(16,185,129,0.1); }
        .safety-msg.finally-msg { color: var(--secondary); background: rgba(139,92,246,0.1); }

        /* Treasure map add form */
        .treasure-form {
            display: flex; gap: 0.4rem; align-items: center; margin-top: 0.6rem; flex-wrap: wrap; justify-content: center;
        }
        .treasure-input {
            width: 100px;
            padding: 0.4rem 0.6rem;
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-family: var(--font-code);
            font-size: 0.65rem;
        }
        .treasure-input:focus { outline: none; border-color: var(--accent); }

        /* Confetti canvas */
        #confettiCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
    </style>
</head>
<body>
    <canvas id="confettiCanvas"></canvas>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">‚ú® Python Adventures</div>
                <div class="sidebar-progress">
                    <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
                    <div class="progress-text" id="progressText">0% complete</div>
                </div>
            </div>
            <div class="sidebar-chapters" id="sidebarChapters"></div>
        </aside>

        <!-- Mobile hamburger -->
        <button class="hamburger" id="hamburger" onclick="toggleSidebar()">‚ò∞</button>
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <!-- Main Content -->
        <div class="main">
            <div class="content-wrapper" id="contentArea"></div>
        </div>
    </div>

    <script>
    // ============================================
    // COURSE DATA
    // ============================================
    const chapters = [
        {
            id: 1, title: "The Magic Backpack", emoji: "üéí", topic: "Variables",
            story: `Meet <strong>Luna</strong>! üéí She's a curious girl who just got the most amazing gift ‚Äî a <strong>magic backpack</strong>! This isn't any ordinary backpack. It has special pouches that can hold <em>anything</em>, and each pouch has a name tag. In Python, these magic pouches are called <strong>variables</strong>! A variable is like a labeled pouch ‚Äî you give it a name, and you can put something inside it.`,
            concepts: [
                { text: `In Python, a <strong>variable</strong> stores a value. You create one by giving it a name and using the <strong>=</strong> sign to assign a value. Variables can hold text (strings), numbers, and more!` },
                { text: `Luna can <strong>change</strong> what's in a pouch anytime! If she eats her cookies and buys new ones, she just puts the new snack in the same pouch. That's <strong>reassignment</strong>.` },
                { text: `To see what's inside a variable, use <strong>print()</strong>. It's like peeking inside the pouch!` }
            ],
            codes: [
                { label: "Creating Variables", code: `<span class="cmt"># Luna puts things in her magic backpack!</span>\n<span class="fn">name</span> <span class="op">=</span> <span class="str">'Luna'</span>\n<span class="fn">age</span> <span class="op">=</span> <span class="num">10</span>\n<span class="fn">snack</span> <span class="op">=</span> <span class="str">'cookies'</span>`, raw: `# Luna puts things in her magic backpack!\nname = 'Luna'\nage = 10\nsnack = 'cookies'` },
                { label: "Using print()", code: `<span class="cmt"># Peek inside the pouches!</span>\n<span class="bi">print</span>(<span class="fn">name</span>)    <span class="cmt"># Shows: Luna</span>\n<span class="bi">print</span>(<span class="fn">age</span>)     <span class="cmt"># Shows: 10</span>\n<span class="bi">print</span>(<span class="fn">snack</span>)   <span class="cmt"># Shows: cookies</span>`, raw: `# Peek inside the pouches!\nprint(name)    # Shows: Luna\nprint(age)     # Shows: 10\nprint(snack)   # Shows: cookies` },
                { label: "Reassigning Variables", code: `<span class="cmt"># Luna changes her snack!</span>\n<span class="fn">snack</span> <span class="op">=</span> <span class="str">'chocolate'</span>\n<span class="bi">print</span>(<span class="fn">snack</span>)   <span class="cmt"># Now shows: chocolate</span>`, raw: `# Luna changes her snack!\nsnack = 'chocolate'\nprint(snack)   # Now shows: chocolate` }
            ],
            interactive: { type: "pouches" },
            quiz: {
                question: "What does this code print? <code>x = 5; x = 10; print(x)</code>",
                options: ["5", "10", "15", "Error"],
                correct: 1,
                explanation: "When you reassign a variable, the old value is replaced. x becomes 10!"
            }
        },
        {
            id: 2, title: "The Dragon's Riddle", emoji: "üêâ", topic: "If/Else",
            story: `Deep inside a <strong>crystal cave</strong>, Luna meets a friendly little dragon! üêâ The dragon guards a magical treasure chest, but there's a catch ‚Äî you need the right <strong>password</strong> to open it! The dragon asks: <em>"What's the password?"</em> In Python, we use <strong>if/else</strong> to check answers ‚Äî just like the dragon checking your password!`,
            concepts: [
                { text: `<strong>if</strong> checks a condition. If it's true ‚Äî the code inside runs! <strong>elif</strong> checks another option. And <strong>else</strong> catches everything else.` },
                { text: `It's like choosing a path: üõ§Ô∏è The <strong>golden gate</strong> opens with "friendship", the <strong>crystal path</strong> appears with "magic", and the <strong>fire gate</strong> stays closed otherwise!` },
                { text: `Comparison operators: <strong>==</strong> (equals), <strong>!=</strong> (not equals), <strong>></strong>, <strong><</strong>, <strong>>=</strong>, <strong><=</strong>` }
            ],
            codes: [
                { label: "Password Check", code: `<span class="cmt"># The dragon checks the password!</span>\n<span class="kw">if</span> <span class="fn">password</span> <span class="op">==</span> <span class="str">'friendship'</span>:\n    <span class="bi">print</span>(<span class="str">'Welcome! üéâ'</span>)\n<span class="kw">elif</span> <span class="fn">password</span> <span class="op">==</span> <span class="str">'magic'</span>:\n    <span class="bi">print</span>(<span class="str">'Almost! ü§î'</span>)\n<span class="kw">else</span>:\n    <span class="bi">print</span>(<span class="str">'Try again! üîí'</span>)`, raw: `# The dragon checks the password!\nif password == 'friendship':\n    print('Welcome! üéâ')\nelif password == 'magic':\n    print('Almost! ü§î')\nelse:\n    print('Try again! üîí')` },
                { label: "Age Check", code: `<span class="cmt"># Checking age</span>\n<span class="fn">age</span> <span class="op">=</span> <span class="num">10</span>\n<span class="kw">if</span> <span class="fn">age</span> <span class="op">>=</span> <span class="num">8</span>:\n    <span class="bi">print</span>(<span class="str">'You can ride the dragon! üêâ'</span>)\n<span class="kw">else</span>:\n    <span class="bi">print</span>(<span class="str">'Maybe next year! üí´'</span>)`, raw: `# Checking age\nage = 10\nif age >= 8:\n    print('You can ride the dragon! üêâ')\nelse:\n    print('Maybe next year! üí´')` }
            ],
            interactive: { type: "riddle" },
            quiz: {
                question: "What does 'elif' stand for?",
                options: ["else if ‚Äî another condition to check", "elephant if ‚Äî a big condition", "element if ‚Äî checking elements", "else info ‚Äî extra information"],
                correct: 0,
                explanation: "elif means 'else if' ‚Äî it checks another condition if the first 'if' was false!"
            }
        },
        {
            id: 3, title: "The Wizard's Spell", emoji: "üßô", topic: "Loops",
            story: `Luna climbs the tallest tower and meets <strong>Kai the Wizard</strong>! üßô Kai is casting a spell that lights up stars in the sky, one by one. But he doesn't cast 5 separate spells ‚Äî he uses a <strong>loop</strong>! A loop repeats something automatically.`,
            concepts: [
                { text: `A <strong>for loop</strong> repeats something a set number of times. It's like saying "do this 5 times!" Use <strong>range(n)</strong> to loop n times.` },
                { text: `A <strong>while loop</strong> keeps going as long as something is true. Like a wizard fighting dragons until there are none left!` },
                { text: `Two magic words: <strong>break</strong> stops the loop instantly, and <strong>continue</strong> skips to the next round.` }
            ],
            codes: [
                { label: "For Loop", code: `<span class="cmt"># Kai lights up 5 stars! ‚≠ê</span>\n<span class="kw">for</span> <span class="fn">star</span> <span class="kw">in</span> <span class="bi">range</span>(<span class="num">5</span>):\n    <span class="bi">print</span>(<span class="str">f'Star {star} is glowing! ‚≠ê'</span>)`, raw: `# Kai lights up 5 stars!\nfor star in range(5):\n    print(f'Star {star} is glowing! ‚≠ê')` },
                { label: "While Loop", code: `<span class="cmt"># Fight dragons until they're all gone!</span>\n<span class="fn">dragons_left</span> <span class="op">=</span> <span class="num">3</span>\n<span class="kw">while</span> <span class="fn">dragons_left</span> <span class="op">></span> <span class="num">0</span>:\n    <span class="bi">print</span>(<span class="str">f'Fighting! {dragons_left} left üêâ'</span>)\n    <span class="fn">dragons_left</span> <span class="op">-=</span> <span class="num">1</span>\n<span class="bi">print</span>(<span class="str">'Victory! üéâ'</span>)`, raw: `# Fight dragons until they're all gone!\ndragons_left = 3\nwhile dragons_left > 0:\n    print(f'Fighting! {dragons_left} left üêâ')\n    dragons_left -= 1\nprint('Victory! üéâ')` }
            ],
            interactive: { type: "spell" },
            quiz: {
                question: "What does range(5) give you?",
                options: ["Numbers 1, 2, 3, 4, 5", "Numbers 0, 1, 2, 3, 4", "The number 5", "Numbers 0 to 5"],
                correct: 1,
                explanation: "range(5) gives you 0, 1, 2, 3, 4 ‚Äî it starts at 0 and stops BEFORE 5!"
            }
        },
        {
            id: 4, title: "The Magical Recipe Book", emoji: "üë©‚Äçüç≥", topic: "Functions",
            story: `Luna enters a cozy kitchen and meets <strong>Chef Maya</strong>! üë©‚Äçüç≥ Maya has a magical recipe book ‚Äî each recipe is a set of steps she can use anytime. In Python, a recipe is called a <strong>function</strong>! You create a function with <strong>def</strong>, give it a name, add ingredients (called <strong>parameters</strong>), and write the steps inside!`,
            concepts: [
                { text: `A <strong>function</strong> is a reusable block of code. Define it once with <strong>def</strong>, then <strong>call</strong> it whenever you need it!` },
                { text: `Functions can take <strong>parameters</strong> (ingredients) and <strong>return</strong> a result (the finished dish).` },
                { text: `Functions are the magic of <strong>code reuse</strong> ‚Äî write the recipe once, use it a million times! ‚ú®` }
            ],
            codes: [
                { label: "Defining a Function", code: `<span class="cmt"># Maya's potion recipe!</span>\n<span class="kw">def</span> <span class="fn">make_potion</span>(<span class="fn">ingredient</span>):\n    <span class="bi">print</span>(<span class="str">f'Mixing {ingredient}...'</span>)\n    <span class="bi">print</span>(<span class="str">'Adding sparkle! ‚ú®'</span>)\n    <span class="kw">return</span> <span class="str">'magical potion'</span>`, raw: `# Maya's potion recipe!\ndef make_potion(ingredient):\n    print(f'Mixing {ingredient}...')\n    print('Adding sparkle! ‚ú®')\n    return 'magical potion'` },
                { label: "Calling Functions", code: `<span class="cmt"># Call the function!</span>\n<span class="fn">result</span> <span class="op">=</span> <span class="fn">make_potion</span>(<span class="str">'starlight'</span>)\n<span class="bi">print</span>(<span class="fn">result</span>)  <span class="cmt"># magical potion</span>\n\n<span class="kw">def</span> <span class="fn">greet</span>(<span class="fn">name</span>):\n    <span class="kw">return</span> <span class="str">'Hello '</span> <span class="op">+</span> <span class="fn">name</span>\n\n<span class="bi">print</span>(<span class="fn">greet</span>(<span class="str">'Maya'</span>))  <span class="cmt"># Hello Maya</span>`, raw: `# Call the function!\nresult = make_potion('starlight')\nprint(result)  # magical potion\n\ndef greet(name):\n    return 'Hello ' + name\n\nprint(greet('Maya'))  # Hello Maya` }
            ],
            interactive: { type: "potion" },
            quiz: {
                question: "What keyword creates a function?",
                options: ["func", "def", "function", "create"],
                correct: 1,
                explanation: "def (short for 'define') is used to create functions in Python!"
            }
        },
        {
            id: 5, title: "The Magical Toy Box", emoji: "üß∏", topic: "Lists",
            story: `In a cozy bedroom, Luna meets <strong>Zara</strong> and her magical toy box! üß∏ This isn't just any box ‚Äî it has <strong>numbered slots</strong> where each toy has its own spot. In Python, this is called a <strong>list</strong>! A list holds items in order, and each item has a number starting from 0.`,
            concepts: [
                { text: `A <strong>list</strong> holds multiple items in order. Create one with square brackets: <strong>[]</strong>. Access items by index (starting from 0).` },
                { text: `Add items with <strong>.append()</strong>, remove with <strong>.remove()</strong>, check length with <strong>len()</strong>.` },
                { text: `You can grab a <strong>slice</strong> of items: <code>toys[1:3]</code> gives items at positions 1 and 2!` }
            ],
            codes: [
                { label: "Creating Lists", code: `<span class="cmt"># Zara's toy box!</span>\n<span class="fn">toys</span> <span class="op">=</span> [<span class="str">'teddy'</span>, <span class="str">'robot'</span>, <span class="str">'dragon'</span>, <span class="str">'puzzle'</span>]\n\n<span class="bi">print</span>(<span class="fn">toys</span>[<span class="num">0</span>])   <span class="cmt"># teddy (first!)</span>\n<span class="bi">print</span>(<span class="fn">toys</span>[<span class="num">2</span>])   <span class="cmt"># dragon</span>`, raw: `# Zara's toy box!\ntoys = ['teddy', 'robot', 'dragon', 'puzzle']\n\nprint(toys[0])   # teddy (first!)\nprint(toys[2])   # dragon` },
                { label: "Modifying Lists", code: `<span class="cmt"># Add a unicorn toy!</span>\n<span class="fn">toys</span>.<span class="bi">append</span>(<span class="str">'unicorn'</span>)\n<span class="bi">print</span>(<span class="bi">len</span>(<span class="fn">toys</span>))  <span class="cmt"># 5 toys now!</span>\n\n<span class="cmt"># Remove the robot</span>\n<span class="fn">toys</span>.<span class="bi">remove</span>(<span class="str">'robot'</span>)\n<span class="bi">print</span>(<span class="fn">toys</span>)`, raw: `# Add a unicorn toy!\ntoys.append('unicorn')\nprint(len(toys))  # 5 toys now!\n\n# Remove the robot\ntoys.remove('robot')\nprint(toys)` }
            ],
            interactive: { type: "toybox" },
            quiz: {
                question: "What is the index of the FIRST item in a Python list?",
                options: ["1", "0", "-1", "first"],
                correct: 1,
                explanation: "Python lists start counting from 0! The first item is at index 0."
            }
        },
        {
            id: 6, title: "The Treasure Map", emoji: "üè¥‚Äç‚ò†Ô∏è", topic: "Dictionaries",
            story: `Ahoy! Luna meets <strong>Captain Rex</strong>! üè¥‚Äç‚ò†Ô∏è He's a young pirate with an amazing treasure map. Each <strong>X mark</strong> has a <em>name</em> (a key!) that leads to a specific treasure (a value!). In Python, this is called a <strong>dictionary</strong>!`,
            concepts: [
                { text: `A <strong>dictionary</strong> uses <strong>keys</strong> to find <strong>values</strong> ‚Äî just like how each X on the map leads to a treasure!` },
                { text: `Add new items, see all keys with <strong>.keys()</strong>, all values with <strong>.values()</strong>, or loop with <strong>.items()</strong>.` },
                { text: `<strong>Golden rule:</strong> No duplicate keys! Each key leads to exactly ONE value. If you reuse a key, it replaces the old value.` }
            ],
            codes: [
                { label: "Creating Dictionaries", code: `<span class="cmt"># Captain Rex's treasure map!</span>\n<span class="fn">treasure</span> <span class="op">=</span> {<span class="str">'gold'</span>: <span class="num">100</span>, <span class="str">'gems'</span>: <span class="num">50</span>, <span class="str">'swords'</span>: <span class="num">3</span>}\n<span class="bi">print</span>(<span class="fn">treasure</span>[<span class="str">'gold'</span>])   <span class="cmt"># 100</span>`, raw: `# Captain Rex's treasure map!\ntreasure = {'gold': 100, 'gems': 50, 'swords': 3}\nprint(treasure['gold'])   # 100` },
                { label: "Looping Through", code: `<span class="cmt"># Add new treasure!</span>\n<span class="fn">treasure</span>[<span class="str">'rubies'</span>] <span class="op">=</span> <span class="num">25</span>\n\n<span class="cmt"># Loop through ALL the treasure!</span>\n<span class="kw">for</span> <span class="fn">key</span>, <span class="fn">value</span> <span class="kw">in</span> <span class="fn">treasure</span>.<span class="bi">items</span>():\n    <span class="bi">print</span>(<span class="str">f"{key}: {value}"</span>)`, raw: `# Add new treasure!\ntreasure['rubies'] = 25\n\n# Loop through ALL the treasure!\nfor key, value in treasure.items():\n    print(f"{key}: {value}")` }
            ],
            interactive: { type: "treasure" },
            quiz: {
                question: "What happens if you use the same key twice in a dictionary?",
                options: ["Error", "Both values are kept", "The second value replaces the first", "Nothing"],
                correct: 2,
                explanation: "Dictionaries can't have duplicate keys ‚Äî the new value replaces the old one!"
            }
        },
        {
            id: 7, title: "The Magic Spell Scroll", emoji: "üìú", topic: "Strings",
            story: `Luna enters a mysterious library and meets <strong>Aria</strong>, a young witch! üìú Aria has a magical spell scroll that can <strong>transform words</strong> with special incantations. In Python, words are called <strong>strings</strong>, and the spells are <strong>string methods</strong>!`,
            concepts: [
                { text: `<strong>.upper()</strong> makes text SHOUT, <strong>.lower()</strong> makes it quiet. These are <strong>string methods</strong> ‚Äî built-in spells for text!` },
                { text: `<strong>.replace()</strong> swaps words, <strong>.split()</strong> breaks text into pieces, and <strong>slicing</strong> with [start:end] grabs parts.` },
                { text: `<strong>f-strings</strong> let you mix variables right inside text: <code>f"I am {name}"</code> ‚Äî powerful magic! ‚ú®` }
            ],
            codes: [
                { label: "String Methods", code: `<span class="cmt"># Aria's spell transformations!</span>\n<span class="fn">spell</span> <span class="op">=</span> <span class="str">"hello world"</span>\n<span class="fn">spell</span>.<span class="bi">upper</span>()     <span class="cmt"># "HELLO WORLD" üî•</span>\n<span class="fn">spell</span>.<span class="bi">lower</span>()     <span class="cmt"># "hello world" üåä</span>\n<span class="bi">len</span>(<span class="fn">spell</span>)        <span class="cmt"># 11 characters</span>`, raw: `# Aria's spell transformations!\nspell = "hello world"\nspell.upper()     # "HELLO WORLD"\nspell.lower()     # "hello world"\nlen(spell)        # 11 characters` },
                { label: "Replace, Split & f-strings", code: `<span class="cmt"># Replace and split magic!</span>\n<span class="fn">spell</span>.<span class="bi">replace</span>(<span class="str">'world'</span>, <span class="str">'python'</span>)  <span class="cmt"># "hello python"</span>\n<span class="fn">spell</span>.<span class="bi">split</span>()                    <span class="cmt"># ['hello', 'world']</span>\n<span class="fn">spell</span>[<span class="num">0</span>:<span class="num">5</span>]                      <span class="cmt"># "hello"</span>\n\n<span class="cmt"># f-strings!</span>\n<span class="fn">name</span> <span class="op">=</span> <span class="str">"Aria"</span>\n<span class="fn">greeting</span> <span class="op">=</span> <span class="str">f"I am {name}"</span>  <span class="cmt"># "I am Aria" ‚ú®</span>`, raw: `# Replace and split magic!\nspell.replace('world', 'python')  # "hello python"\nspell.split()                    # ['hello', 'world']\nspell[0:5]                      # "hello"\n\n# f-strings!\nname = "Aria"\ngreeting = f"I am {name}"  # "I am Aria"` }
            ],
            interactive: { type: "spellscroll" },
            quiz: {
                question: "What does 'hello world'.split() return?",
                options: ["'hello world'", "['hello', 'world']", "['h','e','l','l','o',' ','w','o','r','l','d']", "Error"],
                correct: 1,
                explanation: "split() breaks a string into a list at each space by default!"
            }
        },
        {
            id: 8, title: "The Talking Crystal Ball", emoji: "üîÆ", topic: "Input/Output",
            story: `In a mystical tent, Luna meets <strong>Sage</strong>, a fortune teller kid! üîÆ Sage has a crystal ball that can <strong>listen</strong> to what you say and <strong>speak</strong> back. In Python, this is <strong>input()</strong> and <strong>print()</strong>!`,
            concepts: [
                { text: `<strong>input()</strong> asks a question and waits for the user's answer. <strong>print()</strong> shows output.` },
                { text: `<strong>Secret:</strong> input() always returns a <strong>string</strong>! Even if you type a number, it's text. Use <strong>int()</strong> or <strong>float()</strong> to convert!` },
                { text: `With <strong>f-strings</strong>, you can weave variables right into messages: <code>f"Hello {name}!"</code>` }
            ],
            codes: [
                { label: "Input & Output", code: `<span class="cmt"># The crystal ball listens and speaks!</span>\n<span class="fn">name</span> <span class="op">=</span> <span class="bi">input</span>(<span class="str">"What is your name? "</span>)  <span class="cmt"># Listens üëÇ</span>\n<span class="bi">print</span>(<span class="str">"Hello "</span> <span class="op">+</span> <span class="fn">name</span>)               <span class="cmt"># Speaks üëÑ</span>`, raw: `# The crystal ball listens and speaks!\nname = input("What is your name? ")\nprint("Hello " + name)` },
                { label: "Type Conversion", code: `<span class="cmt"># Type conversion magic!</span>\n<span class="fn">age</span> <span class="op">=</span> <span class="bi">int</span>(<span class="bi">input</span>(<span class="str">"Your age? "</span>))  <span class="cmt"># "10" ‚Üí 10</span>\n<span class="bi">print</span>(<span class="str">f"You are {age} years old!"</span>)\n\n<span class="cmt"># ‚ö†Ô∏è input() always returns a STRING!</span>\n<span class="cmt"># Use int() or float() to convert for math!</span>`, raw: `# Type conversion magic!\nage = int(input("Your age? "))  # "10" ‚Üí 10\nprint(f"You are {age} years old!")\n\n# ‚ö†Ô∏è input() always returns a STRING!` }
            ],
            interactive: { type: "crystalball" },
            quiz: {
                question: "What type does input() always return?",
                options: ["int", "float", "str (string)", "It depends on what you type"],
                correct: 2,
                explanation: "input() ALWAYS returns a string! Even '42' is a string until you convert it with int()."
            }
        },
        {
            id: 9, title: "The Pet Factory", emoji: "üè≠", topic: "Classes & Objects",
            story: `Luna discovers a magical factory run by <strong>Leo</strong>, a kid inventor! üè≠ Leo's factory makes <strong>pets</strong>! But first, he needs a <strong>blueprint</strong>. In Python, a blueprint is called a <strong>class</strong>, and each pet is an <strong>object</strong>!`,
            concepts: [
                { text: `A <strong>class</strong> is the plan ‚Äî it says what every pet should have. The <strong>__init__</strong> method builds each pet with unique features.` },
                { text: `An <strong>object</strong> is created from a class. Same blueprint, different values ‚Äî like cookie cutters making cookies with different toppings! üç™` },
                { text: `<strong>Methods</strong> are functions inside a class. They define what objects can <em>do</em>. That's <strong>object-oriented programming</strong>!` }
            ],
            codes: [
                { label: "Defining a Class", code: `<span class="cmt"># Leo's Pet Blueprint (a class!)</span>\n<span class="kw">class</span> <span class="fn">Pet</span>:\n    <span class="kw">def</span> <span class="fn">__init__</span>(<span class="fn">self</span>, <span class="fn">name</span>, <span class="fn">sound</span>):\n        <span class="fn">self</span>.<span class="fn">name</span> <span class="op">=</span> <span class="fn">name</span>\n        <span class="fn">self</span>.<span class="fn">sound</span> <span class="op">=</span> <span class="fn">sound</span>\n\n    <span class="kw">def</span> <span class="fn">speak</span>(<span class="fn">self</span>):\n        <span class="bi">print</span>(<span class="str">f"{self.name} says {self.sound}"</span>)`, raw: `# Leo's Pet Blueprint\nclass Pet:\n    def __init__(self, name, sound):\n        self.name = name\n        self.sound = sound\n\n    def speak(self):\n        print(f"{self.name} says {self.sound}")` },
                { label: "Creating Objects", code: `<span class="cmt"># Create pets from the blueprint!</span>\n<span class="fn">cat</span> <span class="op">=</span> <span class="fn">Pet</span>(<span class="str">"Whiskers"</span>, <span class="str">"Meow!"</span>)\n<span class="fn">dog</span> <span class="op">=</span> <span class="fn">Pet</span>(<span class="str">"Buddy"</span>, <span class="str">"Woof!"</span>)\n\n<span class="fn">cat</span>.<span class="fn">speak</span>()  <span class="cmt"># "Whiskers says Meow!"</span>\n<span class="fn">dog</span>.<span class="fn">speak</span>()  <span class="cmt"># "Buddy says Woof!"</span>`, raw: `# Create pets from the blueprint!\ncat = Pet("Whiskers", "Meow!")\ndog = Pet("Buddy", "Woof!")\n\ncat.speak()  # "Whiskers says Meow!"\ndog.speak()  # "Buddy says Woof!"` }
            ],
            interactive: { type: "petfactory" },
            quiz: {
                question: "What is 'self' in a Python class?",
                options: ["A built-in function", "The current object instance", "A variable name", "A keyword for printing"],
                correct: 1,
                explanation: "self refers to the current object ‚Äî it's how the object talks about itself!"
            }
        },
        {
            id: 10, title: "The Safety Net", emoji: "üé™", topic: "Try/Except",
            story: `Luna arrives at a spectacular circus! üé™ Up on the high wire, she meets <strong>Zoe</strong>, a fearless acrobat! Zoe does <strong>dangerous tricks</strong> ‚Äî but she ALWAYS has a <strong>safety net</strong> below her! In Python, the safety net is <strong>try/except</strong>!`,
            concepts: [
                { text: `The <strong>try</strong> block is where the dangerous code runs. If something goes wrong, <strong>except</strong> catches the error ‚Äî no crash!` },
                { text: `Different errors: <strong>ZeroDivisionError</strong> (dividing by zero), <strong>ValueError</strong> (wrong type), <strong>IndexError</strong> (out of range).` },
                { text: `The <strong>finally</strong> block ALWAYS runs ‚Äî whether the trick succeeds or fails. It's Zoe's bow at the end! üéÄ` }
            ],
            codes: [
                { label: "Try/Except", code: `<span class="cmt"># Zoe on the tightrope!</span>\n<span class="kw">try</span>:\n    <span class="fn">result</span> <span class="op">=</span> <span class="num">10</span> <span class="op">/</span> <span class="num">0</span>  <span class="cmt"># Dangerous! üò±</span>\n<span class="kw">except</span> <span class="fn">ZeroDivisionError</span>:\n    <span class="bi">print</span>(<span class="str">"Can't divide by zero!"</span>)  <span class="cmt"># Safety net! ü•Ö</span>`, raw: `# Zoe on the tightrope!\ntry:\n    result = 10 / 0\nexcept ZeroDivisionError:\n    print("Can't divide by zero!")` },
                { label: "Finally Block", code: `<span class="cmt"># The Bow ‚Äî finally ALWAYS runs!</span>\n<span class="kw">try</span>:\n    <span class="fn">number</span> <span class="op">=</span> <span class="bi">int</span>(<span class="str">"hello"</span>)  <span class="cmt"># Can't convert! üò±</span>\n<span class="kw">except</span> <span class="fn">ValueError</span>:\n    <span class="bi">print</span>(<span class="str">"That's not a number!"</span>)\n<span class="kw">finally</span>:\n    <span class="bi">print</span>(<span class="str">"Zoe takes a bow!"</span>)  <span class="cmt"># Always! üéÄ</span>`, raw: `# The Bow ‚Äî finally ALWAYS runs!\ntry:\n    number = int("hello")\nexcept ValueError:\n    print("That's not a number!")\nfinally:\n    print("Zoe takes a bow!")` }
            ],
            interactive: { type: "safetynet" },
            quiz: {
                question: "When does the 'finally' block run?",
                options: ["Only when there's an error", "Only when there's no error", "Always, no matter what", "Never"],
                correct: 2,
                explanation: "finally ALWAYS runs ‚Äî whether the try succeeded or an except caught an error!"
            }
        }
    ];

    // ============================================
    // STATE
    // ============================================
    let currentChapterIdx = 0;
    let progress = JSON.parse(localStorage.getItem('pyAdventuresProgress') || '{}');
    let expandedChapters = { 0: true };

    // Interactive state
    let spellIndex = 0;
    let selectedIngredient = null;
    let toyList = [];
    let treasureCount = 3;
    let selectedPetName = null;
    let selectedPetIcon = '';
    let selectedPetSound = null;
    let createdPets = [];

    function saveProgress() { localStorage.setItem('pyAdventuresProgress', JSON.stringify(progress)); }
    function isComplete(id) { return !!progress[id]; }

    function getCompletionPct() {
        let done = 0;
        chapters.forEach(ch => { if (progress[ch.id]) done++; });
        return Math.round((done / chapters.length) * 100);
    }

    // ============================================
    // RENDER SIDEBAR
    // ============================================
    function renderSidebar() {
        const pct = getCompletionPct();
        document.getElementById('progressFill').style.width = pct + '%';
        document.getElementById('progressText').textContent = pct + '% complete';

        const container = document.getElementById('sidebarChapters');
        container.innerHTML = chapters.map((ch, idx) => {
            const done = isComplete(ch.id);
            const isExp = expandedChapters[idx];
            const isActive = idx === currentChapterIdx;
            return `
                <div class="chapter-group">
                    <div class="chapter-header ${isActive ? 'active' : ''}" onclick="toggleChapter(${idx})">
                        <div class="chapter-check ${done ? 'done' : ''}">${done ? '‚úì' : ''}</div>
                        <span>${ch.emoji} ${ch.title}</span>
                        <span class="chapter-chevron ${isExp ? 'expanded' : ''}">‚ñ∂</span>
                    </div>
                    <div class="chapter-lessons ${isExp ? 'expanded' : ''}">
                        <div class="lesson-item ${isActive ? 'active' : ''}" onclick="goToChapter(${idx})">
                            <div class="lesson-dot"></div>
                            ${ch.topic}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function toggleChapter(idx) {
        expandedChapters[idx] = !expandedChapters[idx];
        renderSidebar();
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
        document.getElementById('overlay').classList.toggle('show');
    }

    // ============================================
    // RENDER CONTENT
    // ============================================
    function goToChapter(idx) {
        currentChapterIdx = idx;
        expandedChapters[idx] = true;
        renderSidebar();
        renderContent();
        document.getElementById('contentArea').scrollTop = 0;
        window.scrollTo(0, 0);
        // Close mobile sidebar
        document.getElementById('sidebar').classList.remove('open');
        document.getElementById('overlay').classList.remove('show');
        // Reset interactive state
        spellIndex = 0;
        selectedIngredient = null;
        toyList = [];
        treasureCount = 3;
        selectedPetName = null; selectedPetIcon = ''; selectedPetSound = null;
        createdPets = [];
    }

    function renderContent() {
        const ch = chapters[currentChapterIdx];
        const done = isComplete(ch.id);
        const area = document.getElementById('contentArea');

        let html = `
            <div class="lesson-header">
                <div class="lesson-chapter-label">Chapter ${ch.id} ¬∑ ${ch.topic}</div>
                <h1 class="lesson-title">${ch.emoji} ${ch.title}</h1>
                <p class="lesson-desc">Learn about ${ch.topic.toLowerCase()} through an enchanting story adventure!</p>
            </div>

            <!-- Story -->
            <div class="story-card">
                <div class="story-card-label">üìñ Story Time</div>
                <p>${ch.story}</p>
            </div>

            <!-- Concepts -->
            <div class="glass-card">
                <h3>üí° What You'll Learn</h3>
                ${ch.concepts.map(c => `<p>${c.text}</p>`).join('<br>')}
            </div>

            <!-- Code Examples -->
            ${ch.codes.map(c => `
                <div class="code-block">
                    <div class="code-header">
                        <span>‚ú® ${c.label}</span>
                        <button class="copy-btn" onclick="copyCode(this, \`${c.raw.replace(/`/g, '\\`').replace(/\\/g, '\\\\')}\`)">üìã Copy</button>
                    </div>
                    <div class="code-content">${c.code}</div>
                </div>
            `).join('')}

            <!-- Interactive -->
            <div class="interactive-card">
                <h3>üéÆ Try It Yourself!</h3>
                <div class="subtitle">${getInteractiveSubtitle(ch.interactive.type)}</div>
                <div id="interactiveArea">${renderInteractive(ch.interactive.type, ch.id)}</div>
            </div>

            <!-- Quiz -->
            <div class="quiz-card">
                <h3>üß† Quick Quiz</h3>
                <p style="font-size:0.75rem;color:var(--text-secondary);margin-bottom:0.8rem;">${ch.quiz.question}</p>
                <div id="quizArea">
                    ${ch.quiz.options.map((opt, i) => `
                        <button class="quiz-option" onclick="checkQuiz(${i}, ${ch.quiz.correct}, '${ch.quiz.explanation.replace(/'/g, "\\'")}')">${opt}</button>
                    `).join('')}
                </div>
                <div class="quiz-result" id="quizResult"></div>
            </div>

            <!-- Complete -->
            <div class="complete-section">
                <button class="complete-btn ${done ? 'completed' : ''}" onclick="markChapterComplete(${ch.id})" ${done ? 'disabled' : ''}>
                    ${done ? '‚úÖ Chapter Complete!' : '‚≠ê Mark Chapter Complete'}
                </button>
            </div>

            <!-- Navigation -->
            <div class="nav-buttons">
                <button class="nav-btn" onclick="goToChapter(${currentChapterIdx - 1})" ${currentChapterIdx === 0 ? 'disabled' : ''}>
                    ‚Üê Previous
                </button>
                <button class="nav-btn" onclick="goToChapter(${currentChapterIdx + 1})" ${currentChapterIdx === chapters.length - 1 ? 'disabled' : ''}>
                    Next ‚Üí
                </button>
            </div>
        `;

        area.innerHTML = html;
    }

    function getInteractiveSubtitle(type) {
        const subs = {
            pouches: "Click each pouch to see what's inside!",
            riddle: "What's the password to open the treasure chest?",
            spell: "Click to light up each star ‚Äî just like a for loop!",
            potion: "Pick an ingredient, then brew your magical potion!",
            toybox: "Click toys to add them to Zara's toy box!",
            treasure: "Click X marks to reveal treasures, then add your own!",
            spellscroll: "Type a word, then click a spell to transform it!",
            crystalball: "Type your name and age, then ask the crystal ball!",
            petfactory: "Pick a name and sound, then create your pet!",
            safetynet: "Click a dangerous trick and watch the safety net catch the error!"
        };
        return subs[type] || '';
    }

    function renderInteractive(type, chId) {
        switch(type) {
            case 'pouches': return `
                <div class="i-flex">
                    <div class="i-item" onclick="revealPouch(this)"><span>üëù</span><div class="i-label">name</div><div class="i-value">'Luna'</div></div>
                    <div class="i-item" onclick="revealPouch(this)"><span>üëù</span><div class="i-label">age</div><div class="i-value">10</div></div>
                    <div class="i-item" onclick="revealPouch(this)"><span>üëù</span><div class="i-label">snack</div><div class="i-value">'cookies'</div></div>
                </div>
                <div class="i-result" id="iResult"></div>`;

            case 'riddle': return `
                <p style="text-align:center;font-size:0.8rem;color:var(--secondary);margin-bottom:0.8rem;">üîê The dragon asks: "What opens the golden gate?"</p>
                <div class="i-flex">
                    <button class="i-btn" onclick="checkRiddle(this,'wrong')">üîÆ magic</button>
                    <button class="i-btn" onclick="checkRiddle(this,'correct')">üíõ friendship</button>
                    <button class="i-btn" onclick="checkRiddle(this,'wrong')">üóùÔ∏è treasure</button>
                </div>
                <div class="i-result" id="iResult"></div>`;

            case 'spell': return `
                <div class="i-flex" id="spellStars">
                    ${'‚≠ê'.repeat(5).split('').map((_,i) => `<span style="font-size:1.8rem;opacity:0.2;transition:all 0.3s;cursor:default;" id="star${i}">‚≠ê</span>`).join('')}
                </div>
                <div style="text-align:center"><button class="i-btn" onclick="castSpell()">ü™Ñ Cast Spell!</button></div>
                <div class="i-info" id="spellCounter">for star in range(5): ‚ú®</div>`;

            case 'potion': return `
                <div class="i-flex">
                    <div class="i-item" onclick="selectIng(this,'starlight')">‚≠ê<div class="i-label">starlight</div></div>
                    <div class="i-item" onclick="selectIng(this,'moonbeam')">üåô<div class="i-label">moonbeam</div></div>
                    <div class="i-item" onclick="selectIng(this,'rainbow')">üåà<div class="i-label">rainbow</div></div>
                    <div class="i-item" onclick="selectIng(this,'crystal')">üíé<div class="i-label">crystal</div></div>
                </div>
                <div style="text-align:center;font-size:2rem;margin:0.5rem 0;" id="cauldron">üß™</div>
                <div style="text-align:center"><button class="i-btn" onclick="brewPotion()">üî• Brew Potion!</button></div>
                <div class="i-result" id="iResult"></div>`;

            case 'toybox': return `
                <div class="i-flex">
                    <button class="i-btn" onclick="addToy('üß∏','teddy')">üß∏</button>
                    <button class="i-btn" onclick="addToy('ü§ñ','robot')">ü§ñ</button>
                    <button class="i-btn" onclick="addToy('üêâ','dragon')">üêâ</button>
                    <button class="i-btn" onclick="addToy('üß©','puzzle')">üß©</button>
                    <button class="i-btn" onclick="addToy('ü¶Ñ','unicorn')">ü¶Ñ</button>
                    <button class="i-btn" onclick="addToy('üöÄ','rocket')">üöÄ</button>
                </div>
                <div class="i-slots" id="toySlots"><span style="color:var(--text-muted);font-size:0.7rem;">toys = [ ] ‚Äî Click toys above!</span></div>
                <div class="i-info" id="toyInfo">len(toys) = 0</div>
                <div class="i-flex">
                    <button class="i-btn" onclick="removeLast()">Remove Last üóëÔ∏è</button>
                    <button class="i-btn" onclick="clearToys()">Clear All üßπ</button>
                </div>`;

            case 'treasure': return `
                <div class="i-flex" id="treasureMap">
                    <div class="i-item" onclick="revealTreasure(this)" data-revealed="false"><span>‚ùå</span><div class="i-label">'gold'</div><div class="i-value">100 ü™ô</div></div>
                    <div class="i-item" onclick="revealTreasure(this)" data-revealed="false"><span>‚ùå</span><div class="i-label">'gems'</div><div class="i-value">50 üíé</div></div>
                    <div class="i-item" onclick="revealTreasure(this)" data-revealed="false"><span>‚ùå</span><div class="i-label">'swords'</div><div class="i-value">3 ‚öîÔ∏è</div></div>
                </div>
                <div class="treasure-form">
                    <input class="treasure-input" id="tKey" placeholder="key" maxlength="12">
                    <span style="color:var(--text-muted)">:</span>
                    <input class="treasure-input" id="tVal" placeholder="value" maxlength="12">
                    <button class="i-btn" onclick="addTreasure()">‚ûï Add</button>
                </div>
                <div class="i-info" id="treasureInfo">len(treasure) = 3</div>`;

            case 'spellscroll': return `
                <input class="spell-input" id="spellInput" value="hello world" placeholder="Type your text...">
                <div class="i-flex">
                    <button class="i-btn" onclick="castStringSpell('upper')">.upper() üî•</button>
                    <button class="i-btn" onclick="castStringSpell('lower')">.lower() üåä</button>
                    <button class="i-btn" onclick="castStringSpell('replace')">.replace() üîÑ</button>
                    <button class="i-btn" onclick="castStringSpell('split')">.split() ‚úÇÔ∏è</button>
                    <button class="i-btn" onclick="castStringSpell('len')">len() üìè</button>
                    <button class="i-btn" onclick="castStringSpell('reverse')">[::-1] ü™û</button>
                </div>
                <div class="spell-result" id="spellResult">‚ú® Cast a spell to see the magic!</div>`;

            case 'crystalball': return `
                <div style="text-align:center;font-size:2rem;margin-bottom:0.5rem;">üîÆ</div>
                <div class="crystal-prompt">name = input("What is your name? ")</div>
                <input class="crystal-input" id="cName" placeholder="Type your name...">
                <div class="crystal-prompt">age = int(input("Your age? "))</div>
                <input class="crystal-input" id="cAge" placeholder="Type your age...">
                <div style="text-align:center;margin:0.6rem 0"><button class="i-btn" onclick="askCrystal()">üîÆ Ask the Crystal Ball!</button></div>
                <div class="crystal-output" id="crystalOutput">The crystal ball awaits...</div>`;

            case 'petfactory': return `
                <div class="factory-group">
                    <div class="factory-label">Choose a Pet Name:</div>
                    <div class="factory-opts" id="nameOpts">
                        <button class="factory-opt" onclick="selPetName(this,'Whiskers','üê±')">üê± Whiskers</button>
                        <button class="factory-opt" onclick="selPetName(this,'Buddy','üê∂')">üê∂ Buddy</button>
                        <button class="factory-opt" onclick="selPetName(this,'Tweety','üê¶')">üê¶ Tweety</button>
                        <button class="factory-opt" onclick="selPetName(this,'Rex','ü¶é')">ü¶é Rex</button>
                    </div>
                </div>
                <div class="factory-group">
                    <div class="factory-label">Choose a Sound:</div>
                    <div class="factory-opts" id="soundOpts">
                        <button class="factory-opt" onclick="selPetSound(this,'Meow!')">Meow!</button>
                        <button class="factory-opt" onclick="selPetSound(this,'Woof!')">Woof!</button>
                        <button class="factory-opt" onclick="selPetSound(this,'Tweet!')">Tweet!</button>
                        <button class="factory-opt" onclick="selPetSound(this,'Roar!')">Roar!</button>
                    </div>
                </div>
                <div style="text-align:center;margin:0.6rem 0"><button class="i-btn" onclick="buildPet()">‚öôÔ∏è Build Pet!</button></div>
                <div class="conveyor" id="conveyorBelt"><span style="color:var(--text-muted);font-size:0.65rem;">üè≠ Build some pets!</span></div>
                <div class="i-result" id="petResult"></div>`;

            case 'safetynet': return `
                <div class="trick-btns">
                    <button class="trick-btn" onclick="attemptTrick('zero')">10 / 0 üí•</button>
                    <button class="trick-btn" onclick="attemptTrick('value')">int("hello") üí•</button>
                    <button class="trick-btn" onclick="attemptTrick('index')">list[99] üí•</button>
                    <button class="trick-btn" onclick="attemptTrick('safe')">10 / 2 ‚ú®</button>
                </div>
                <div class="safety-display" id="safetyDisplay">
                    <span class="acrobat">ü§∏</span>
                    <div id="safetyMsgs"></div>
                </div>`;

            default: return '';
        }
    }

    // ============================================
    // COPY CODE
    // ============================================
    function copyCode(btn, code) {
        navigator.clipboard.writeText(code.replace(/\\n/g, '\n'));
        btn.textContent = '‚úÖ Copied!';
        btn.classList.add('copied');
        setTimeout(() => { btn.textContent = 'üìã Copy'; btn.classList.remove('copied'); }, 2000);
    }

    // ============================================
    // QUIZ
    // ============================================
    function checkQuiz(selected, correct, explanation) {
        const btns = document.querySelectorAll('.quiz-option');
        btns.forEach((b, i) => {
            b.disabled = true;
            if (i === correct) b.classList.add('correct');
            else if (i === selected) b.classList.add('wrong');
        });
        const res = document.getElementById('quizResult');
        if (selected === correct) {
            res.innerHTML = `<span style="color:var(--success)">üéâ Correct! ${explanation}</span>`;
            miniCelebrate();
        } else {
            res.innerHTML = `<span style="color:var(--danger)">‚ùå Not quite. ${explanation}</span>`;
        }
    }

    // ============================================
    // MARK COMPLETE
    // ============================================
    function markChapterComplete(id) {
        progress[id] = true;
        saveProgress();
        renderSidebar();
        renderContent();
        launchConfetti();
    }

    // ============================================
    // INTERACTIVE HANDLERS
    // ============================================
    function revealPouch(el) {
        el.classList.add('revealed');
        el.querySelector('span').textContent = 'üëú';
        if (document.querySelectorAll('.i-item.revealed').length === 3) {
            document.getElementById('iResult').textContent = 'üéâ All pouches opened!';
            miniCelebrate();
        }
    }

    function checkRiddle(btn, result) {
        if (result === 'correct') {
            btn.style.borderColor = 'var(--success)'; btn.style.background = 'rgba(16,185,129,0.15)';
            document.getElementById('iResult').innerHTML = 'üéâ The golden gate opens! Welcome!';
            miniCelebrate();
        } else {
            btn.style.borderColor = 'var(--danger)'; btn.style.background = 'rgba(239,68,68,0.1)';
            setTimeout(() => { btn.style.borderColor = ''; btn.style.background = ''; }, 1000);
        }
    }

    function castSpell() {
        if (spellIndex >= 5) {
            spellIndex = 0;
            for (let i = 0; i < 5; i++) document.getElementById('star'+i).style.opacity = '0.2';
            document.getElementById('spellCounter').textContent = 'for star in range(5): ‚ú®';
            return;
        }
        const star = document.getElementById('star'+spellIndex);
        star.style.opacity = '1';
        star.style.filter = 'drop-shadow(0 0 8px rgba(251,191,36,0.8))';
        document.getElementById('spellCounter').textContent = `star = ${spellIndex} ‚Üí glowing! ‚≠ê`;
        spellIndex++;
        if (spellIndex >= 5) {
            document.getElementById('spellCounter').textContent = 'All 5 stars glowing! ‚ú® Loop complete!';
            miniCelebrate();
        }
    }

    function selectIng(el, name) {
        document.querySelectorAll('#interactiveArea .i-item').forEach(i => i.classList.remove('selected'));
        el.classList.add('selected');
        selectedIngredient = name;
    }

    function brewPotion() {
        if (!selectedIngredient) { document.getElementById('iResult').textContent = '‚òùÔ∏è Pick an ingredient first!'; return; }
        const c = document.getElementById('cauldron');
        c.textContent = 'üî•';
        document.getElementById('iResult').textContent = `Mixing ${selectedIngredient}... ‚ú®`;
        setTimeout(() => {
            c.textContent = 'üß™';
            const potions = {starlight:'üåü Potion of Brilliance!',moonbeam:'üåô Potion of Dreams!',rainbow:'üåà Potion of Joy!',crystal:'üíé Potion of Clarity!'};
            document.getElementById('iResult').textContent = potions[selectedIngredient] || '‚ú® Magical Potion!';
            miniCelebrate();
        }, 1000);
    }

    function addToy(emoji, name) {
        if (toyList.length >= 6) return;
        toyList.push({emoji, name});
        updateToyBox();
    }
    function removeLast() { toyList.pop(); updateToyBox(); }
    function clearToys() { toyList = []; updateToyBox(); }
    function updateToyBox() {
        const slots = document.getElementById('toySlots');
        const info = document.getElementById('toyInfo');
        if (!toyList.length) {
            slots.innerHTML = '<span style="color:var(--text-muted);font-size:0.7rem;">toys = [ ] ‚Äî Click toys above!</span>';
        } else {
            slots.innerHTML = toyList.map((t,i) => `<div class="i-slot"><span class="idx">[${i}]</span><span class="emoji">${t.emoji}</span></div>`).join('');
        }
        info.textContent = `len(toys) = ${toyList.length}`;
        if (toyList.length >= 4) miniCelebrate();
    }

    function revealTreasure(el) {
        if (el.dataset.revealed === 'true') return;
        el.dataset.revealed = 'true';
        el.classList.add('revealed');
        el.querySelector('span').textContent = 'üèÜ';
        if (document.querySelectorAll('.i-item.revealed').length >= treasureCount) miniCelebrate();
    }
    function addTreasure() {
        const k = document.getElementById('tKey').value.trim();
        const v = document.getElementById('tVal').value.trim();
        if (!k || !v) return;
        treasureCount++;
        const map = document.getElementById('treasureMap');
        const el = document.createElement('div');
        el.className = 'i-item revealed';
        el.innerHTML = `<span>üèÜ</span><div class="i-label">'${k}'</div><div class="i-value">${v} ‚ú®</div>`;
        map.appendChild(el);
        document.getElementById('treasureInfo').textContent = `len(treasure) = ${treasureCount}`;
        document.getElementById('tKey').value = '';
        document.getElementById('tVal').value = '';
        miniCelebrate();
    }

    function castStringSpell(method) {
        const text = document.getElementById('spellInput').value;
        if (!text) return;
        const res = document.getElementById('spellResult');
        switch(method) {
            case 'upper': res.textContent = `"${text.toUpperCase()}" üî•`; break;
            case 'lower': res.textContent = `"${text.toLowerCase()}" üåä`; break;
            case 'replace': res.textContent = `"${text.replace(text.split(' ').pop(),'python')}" üîÑ`; break;
            case 'split': res.textContent = `[${text.split(' ').map(p=>`'${p}'`).join(', ')}] ‚úÇÔ∏è`; break;
            case 'len': res.textContent = `${text.length} characters üìè`; break;
            case 'reverse': res.textContent = `"${text.split('').reverse().join('')}" ü™û`; break;
        }
        miniCelebrate();
    }

    function askCrystal() {
        const name = document.getElementById('cName').value.trim();
        const ageStr = document.getElementById('cAge').value.trim();
        const out = document.getElementById('crystalOutput');
        if (!name && !ageStr) { out.textContent = '‚úèÔ∏è Type your name and age first!'; return; }
        let lines = [];
        if (name) { lines.push(`>>> name = "${name}"`); lines.push(`>>> print("Hello " + name)`); lines.push(`Hello ${name}`); }
        if (ageStr) {
            const age = parseInt(ageStr);
            if (isNaN(age)) { lines.push(`>>> age = int("${ageStr}")`); lines.push(`‚ö†Ô∏è ValueError: "${ageStr}" is not a number!`); }
            else { lines.push(`>>> age = int("${ageStr}")  # "${ageStr}" ‚Üí ${age}`); lines.push(`You are ${age} years old!`);
                lines.push(age < 10 ? 'üîÆ "A young adventurer!"' : age <= 15 ? 'üîÆ "A brave explorer!"' : 'üîÆ "A wise wizard!"'); }
        }
        out.innerHTML = lines.map(l => `<div>${l}</div>`).join('');
        miniCelebrate();
    }

    function selPetName(el, name, icon) {
        document.querySelectorAll('#nameOpts .factory-opt').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
        selectedPetName = name; selectedPetIcon = icon;
    }
    function selPetSound(el, sound) {
        document.querySelectorAll('#soundOpts .factory-opt').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
        selectedPetSound = sound;
    }
    function buildPet() {
        if (!selectedPetName || !selectedPetSound) { document.getElementById('petResult').textContent = '‚òùÔ∏è Pick name AND sound!'; return; }
        if (createdPets.length >= 6) { document.getElementById('petResult').textContent = 'üè≠ Belt full!'; return; }
        createdPets.push({name:selectedPetName,icon:selectedPetIcon,sound:selectedPetSound});
        const belt = document.getElementById('conveyorBelt');
        belt.innerHTML = createdPets.map((p,i) => `<div class="pet-card" onclick="speakPet(${i})"><span class="pet-icon">${p.icon}</span><span class="pet-name">${p.name}</span><span class="pet-sound">"${p.sound}"</span></div>`).join('');
        document.getElementById('petResult').textContent = `‚ú® Created Pet("${selectedPetName}", "${selectedPetSound}")!`;
        miniCelebrate();
    }
    function speakPet(i) { document.getElementById('petResult').textContent = `üó£Ô∏è ${createdPets[i].name} says ${createdPets[i].sound}`; }

    function attemptTrick(type) {
        const display = document.getElementById('safetyDisplay');
        const acrobat = display.querySelector('.acrobat');
        const msgs = document.getElementById('safetyMsgs');
        acrobat.textContent = 'ü§∏'; msgs.innerHTML = '';
        let tryCode, errType, errMsg, safe = false;
        switch(type) {
            case 'zero': tryCode='10 / 0'; errType='ZeroDivisionError'; errMsg="Can't divide by zero!"; break;
            case 'value': tryCode='int("hello")'; errType='ValueError'; errMsg="Not a number!"; break;
            case 'index': tryCode='list[99]'; errType='IndexError'; errMsg="Index out of range!"; break;
            case 'safe': tryCode='10 / 2'; safe=true; break;
        }
        setTimeout(() => { msgs.innerHTML += `<div class="safety-msg try-msg">try: ${tryCode}</div>`; }, 200);
        if (!safe) {
            setTimeout(() => { acrobat.textContent = 'üò±'; }, 500);
            setTimeout(() => { acrobat.textContent = 'üòÖ'; msgs.innerHTML += `<div class="safety-msg catch-msg">except ${errType}: "${errMsg}" ü•Ö</div>`; }, 1000);
            setTimeout(() => { acrobat.textContent = 'ü§∏'; msgs.innerHTML += `<div class="safety-msg finally-msg">finally: "Zoe takes a bow!" üéÄ</div>`; miniCelebrate(); }, 1600);
        } else {
            setTimeout(() => { acrobat.textContent = 'ü§©'; msgs.innerHTML += `<div class="safety-msg safe-msg">‚ú® result = 5.0 ‚Äî No error!</div>`; }, 500);
            setTimeout(() => { msgs.innerHTML += `<div class="safety-msg finally-msg">finally: "Zoe takes a bow!" üéÄ</div>`; miniCelebrate(); }, 1000);
        }
    }

    // ============================================
    // CONFETTI
    // ============================================
    const confettiCanvas = document.getElementById('confettiCanvas');
    const confettiCtx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    let confettiAnimating = false;

    function resizeConfetti() { confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; }
    window.addEventListener('resize', resizeConfetti);

    function launchConfetti() {
        resizeConfetti();
        const colors = ['#fbbf24','#f59e0b','#3b82f6','#8b5cf6','#10b981','#ef4444','#ec4899','#06b6d4'];
        for (let i = 0; i < 100; i++) {
            confettiPieces.push({
                x: Math.random()*confettiCanvas.width, y: -20-Math.random()*100,
                w: Math.random()*10+5, h: Math.random()*6+3,
                color: colors[Math.floor(Math.random()*colors.length)],
                vy: Math.random()*3+2, vx: (Math.random()-0.5)*3,
                r: Math.random()*360, rs: (Math.random()-0.5)*10, a: 1
            });
        }
        if (!confettiAnimating) { confettiAnimating = true; animConfetti(); }
    }

    function miniCelebrate() {
        resizeConfetti();
        const colors = ['#fbbf24','#f59e0b','#10b981','#8b5cf6'];
        for (let i = 0; i < 20; i++) {
            confettiPieces.push({
                x: confettiCanvas.width/2+(Math.random()-0.5)*200, y: confettiCanvas.height/2,
                w: Math.random()*8+4, h: Math.random()*5+2,
                color: colors[Math.floor(Math.random()*colors.length)],
                vy: -(Math.random()*5+3), vx: (Math.random()-0.5)*6,
                r: Math.random()*360, rs: (Math.random()-0.5)*15, a: 1
            });
        }
        if (!confettiAnimating) { confettiAnimating = true; animConfetti(); }
    }

    function animConfetti() {
        confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        confettiPieces.forEach(p => {
            p.x += p.vx; p.y += p.vy; p.vy += 0.1; p.r += p.rs; p.a -= 0.005;
            if (p.a > 0) {
                confettiCtx.save();
                confettiCtx.translate(p.x, p.y);
                confettiCtx.rotate(p.r * Math.PI/180);
                confettiCtx.globalAlpha = Math.max(0, p.a);
                confettiCtx.fillStyle = p.color;
                confettiCtx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
                confettiCtx.restore();
            }
        });
        confettiPieces = confettiPieces.filter(p => p.a > 0 && p.y < confettiCanvas.height+50);
        if (confettiPieces.length > 0) requestAnimationFrame(animConfetti);
        else { confettiAnimating = false; confettiCtx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
    }

    // ============================================
    // KEYBOARD NAV
    // ============================================
    document.addEventListener('keydown', e => {
        if (e.key === 'ArrowRight' && currentChapterIdx < chapters.length-1) goToChapter(currentChapterIdx+1);
        else if (e.key === 'ArrowLeft' && currentChapterIdx > 0) goToChapter(currentChapterIdx-1);
    });

    // ============================================
    // INIT
    // ============================================
    resizeConfetti();
    renderSidebar();
    renderContent();
    </script>
</body>
</html>
